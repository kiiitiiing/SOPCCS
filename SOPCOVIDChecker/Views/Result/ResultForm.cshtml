@model ResultForm

<style>
    .text-dangers {
        color: #dc3545 !important;
    }
</style>

<div class="modal-content" id="result_modal">
    <div class="modal-header">
        <h4>
            <i class="far fa-file-alt"></i>
            &nbsp;Result Form
        </h4>
        <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">×</span>
        </button>
    </div>
    <div class="modal-body">
        <form asp-action="ResultForm">
            <input hidden asp-for="Id" />
            <input hidden asp-for="CreatedBy" />
            <input hidden asp-for="CreatedAt" />
            <input hidden asp-for="UpdatedAt" />
            <input hidden asp-for="SopFormId" />
            <table class="table table-bordered">
                <tbody>
                    <tr>
                        <td colspan="17">
                            <label>Name of Patient: </label><span class="text-dangers">@Model.SopForm.Patient.GetFullName().ToUpper()</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Age:</label>
                        </td>
                        <td colspan="2">
                            <span class="text-dangers">@Model.SopForm.Patient.Dob.ComputeAge()</span>
                        </td>
                        <td>
                            <label>Sex:</label>
                        </td>
                        <td colspan="4">
                            <span class="text-dangers">@Model.SopForm.Patient.Sex</span>
                        </td>
                        <td colspan="3">
                            <label>Date of Birth: </label>
                        </td>
                        <td colspan="6">
                            <span class="text-dangers">@Model.SopForm.Patient.Dob.ToString("dd/MM/yyyy")</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" rowspan="4">
                            <label>Patient Location:</label><br />
                            <label>RHU/CHO</label><br />
                            <label>Hospital/Infirmary</label><br />
                            <label>Referral:</label>
                        </td>
                        <td colspan="5" rowspan="4">
                            <span class="text-dangers"></span><br />
                            <span class="text-dangers"></span><br />
                            <span class="text-dangers"></span><br />
                            <span class="text-dangers">@Model.SopForm.DiseaseReportingUnit.Facility.Name</span>
                        </td>
                        <td colspan="3" rowspan="2">
                            <label>Sample ID:</label>
                        </td>
                        <td colspan="6" rowspan="2">
                            <span class="text-dangers">@Model.SopForm.SampleId</span>
                        </td>
                    </tr>
                    <tr>
                    </tr>
                    <tr>
                        <td colspan="3" rowspan="2">
                            <label>Admission Date:</label>
                        </td>
                        <td colspan="6" rowspan="2">
                            <span class="text-dangers">N/A</span>
                        </td>
                    </tr>
                    <tr>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <label>Requisitioner:</label>
                        </td>
                        <td colspan="5">
                            <span class="text-dangers">@Model.SopForm.RequestedBy</span>
                        </td>
                        <td rowspan="2">
                            <label>Address:</label>
                        </td>
                        <td colspan="8" rowspan="2" style="white-space: nowrap;">
                            <span class="text-dangers">@Model.SopForm.Patient.GetAddress()</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <label>Specimen Type:</label>
                        </td>
                        <td colspan="5">
                            <span class="text-dangers">@Model.SopForm.TypeSpecimen</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="5">
                            <label>Date & Time of Specimen Collection:</label>
                        </td>
                        <td colspan="3">
                            <span class="text-dangers">@Model.SopForm.DatetimeCollection.GetDate("dd/MM/yyyy hh:mm tt")</span>
                        </td>
                        <td colspan="6">
                            <label>Date & Time of Specimen Collection:</label>
                        </td>
                        <td colspan="3">
                            <span class="text-dangers">@Model.SopForm.DatetimeSpecimenReceipt.GetDate("dd/MM/yyyy hh:mm tt")</span>
                        </td>
                    </tr>
                    <tr>
                    </tr>
                    <tr>
                        <td colspan="17" class="text-center">
                            <label>LABORATORY TEST RESULT</label>
                        </td>
                    </tr>
                    <tr>
                    </tr>
                    <tr>
                        <td colspan="17">
                            <label>LABORATORY TEST PERFORMED:</label><br />
                            <textarea class="form-control" asp-for="LabTestPerformed" style="height: 100%; width: 100%;">
                                @Model.LabTestPerformed
                            </textarea>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="17"></td>
                    </tr>
                    <tr>
                        <td colspan="3" rowspan="2">
                            <label>TEST RESULT:</label>
                        </td>
                        <td colspan="14" rowspan="2">
                            <span class="text-dangers">@Model.SopForm.PcrResult</span>
                        </td>
                    </tr>
                    <tr>
                    <tr>
                        <td colspan="8">
                            <label>
                                TEST RESULT AND UNITS OR MEASUREMENTS:
                            </label><br />
                            <input class="form-control" asp-for="TestResult" style="height: 100% !important; width: 100% !important; box-sizing: border-box;" />
                        </td>
                        <td colspan="9">
                            <label>
                                BIOLOGICAL REFERENCE INTERVALS:
                            </label><br />
                            <input class="form-control" asp-for="BiologicalReferrence" style="height: 100% !important; width: 100% !important; box-sizing: border-box;" />
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td colspan="17" class="text-center">
                            <label>INTERPRETATION OF RESULTS WHEN APPROPRIATE</label>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="8">
                            <select class="form-control final_result" asp-for="FinalResult" onchange="ResultChange($(this));">
                                <option value="" selected hidden>
                                    Choose Result
                                </option>
                                <option value="SARS-CoV-2 (causative agent of COVID-19) viral RNA detected">
                                    SARS-CoV-2 (causative agent of COVID-19) viral RNA detected
                                </option>
                                <option value="SARS-CoV-2 (causative agent of COVID-19) viral RNA not detected">
                                    SARS-CoV-2 (causative agent of COVID-19) viral RNA not detected
                                </option>
                                <option value="Invalid due to specimen quality">
                                    Invalid due to specimen quality
                                </option>
                            </select>
                        </td>
                        <td colspan="9">
                            <textarea class="form-control" asp-for="Interpretation" id="interpret" rows="2" style="height: 100% !important; width: 100% !important; font-size: 10px; box-sizing: border-box;" readonly>
                                @Model.Interpretation
                            </textarea>
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td colspan="17" class="text-center">
                            <label style="font-style:italic">This laboratory result should be interpreted together with the available clinical and epidemiological information.</label>
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td colspan="17" style=" padding-left: 20px; padding-right: 20px;">
                            <label>Comments:</label><br />
                            <textarea class="form-control" rows="3" asp-for="Comments"></textarea>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="row" style="margin-top:15px;">
                <div class="col-md-4">
                    <label>Performed:</label><br />
                    <select class="form-control" asp-for="PerformedBy" asp-items="ViewBag.Perform" required>
                        <option value="" selected hidden>Select MedTech</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label>Verified:</label><br />
                    <select class="form-control" asp-for="VerifiedBy" asp-items="ViewBag.Verify" required>
                        <option value="" selected hidden>Select Supervisor</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label>Approved:</label><br />
                    <select class="form-control" asp-for="ApprovedBy" asp-items="ViewBag.Approve" required>
                        <option value="" selected hidden>Select Chief</option>
                    </select>
                </div>
            </div>
            @if (ViewBag.Errors != null)
            {
                <div class="row" style="margin-top: 20px;">
                    <div class="col-sm-12 center" style="align-content:center">
                        <span class="text-danger text-sm">Please Input requred fields.</span>
                    </div>
                </div>
            }
        </form>
    </div>
    <div class="modal-footer" style="display: inline-block !important;">
        <button class="btn btn-sm btn-danger fa-pull-left" type="button" data-dismiss="modal">
            Cancel
        </button>
        <button class="btn btn-sm btn-success fa-pull-right" data-action="large_modal" data-save="modal">
            Submit
        </button>
        <button class="btn btn-sm btn-primary fa-pull-right" type="button" onclick="alert('PRINT!');">
            Print
        </button>
    </div>
</div>

<script>
    $(function () {
        $('.select2').select2()
    })

    function ResultChange(value) {
        var interInput = $('#interpret');
        switch (value[0].selectedIndex) {
            case 1: {
                interInput.val('Positive\nfor SARS - CoV - 2(causative agent of COVID - 19');
                break;
            }
            case 2: {
                interInput.val('Negative\nfor SARS - CoV - 2(causative agent of COVID - 19)');
                break;
            }
            case 3: {
                interInput.val('Negative for test internal control\n(most likely due to poor specimen quality)');
                break;
            }
        }
    }
</script>